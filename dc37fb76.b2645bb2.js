(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{139:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"rightToc",(function(){return s})),n.d(t,"metadata",(function(){return c})),n.d(t,"default",(function(){return p}));var a=n(1),r=n(9),i=(n(0),n(143)),o={id:"api-routes",title:"api routes"},s=[{value:"Custom config",id:"custom-config",children:[]}],c={id:"pre6-feature/api-routes",title:"api routes",description:"# API Routes",source:"@site/../docs/pre6-feature/api-routes.md",permalink:"/shuvijs.org/docs/pre6-feature/api-routes",editUrl:"https://github.com/shuvijs/shuvijs.org/tree/master/website/../docs/pre6-feature/api-routes.md",sidebar:"docs",previous:{title:"\u6570\u636e\u83b7\u53d6",permalink:"/shuvijs.org/docs/getInitialProps"},next:{title:"dynamic routes",permalink:"/shuvijs.org/docs/pre6-feature/dynamic-routes"}},l={rightToc:s,metadata:c},b="wrapper";function p(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(i.b)(b,Object(a.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("h1",{id:"api-routes"},"API Routes"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"export default function handler(req, res) {\n  res.status(200).json({ name: 'John Doe' })\n}\n")),Object(i.b)("p",null,"For an API route to work, you need to export a function as default (a.k.a ",Object(i.b)("strong",{parentName:"p"},"request handler"),"), which then receives the following parameters:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"req"),": An instance of ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://nodejs.org/api/http.html#http_class_http_incomingmessage"}),"http.IncomingMessage"),", plus some ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"#enhanced-request"}),"enhanced request")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"res"),": An instance of ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://nodejs.org/api/http.html#http_class_http_serverresponse"}),"http.ServerResponse"),", plus some ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"#enhanced-response"}),"enhanced response"))),Object(i.b)("p",null,"To handle different HTTP methods in an API route, you can use ",Object(i.b)("inlineCode",{parentName:"p"},"req.method")," in your request handler, like so:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"export default function handler(req, res) {\n  if (req.method === 'POST') {\n    // Process a POST request\n  } else {\n    // Handle any other HTTP method\n  }\n}\n")),Object(i.b)("p",null,"To fetch API endpoints, take a look into any of the examples at the start of this section."),Object(i.b)("h1",{id:"enhanced-request"},"enhanced request"),Object(i.b)("p",null,"API routes provide built in middlewares which parse the incoming request (",Object(i.b)("inlineCode",{parentName:"p"},"req"),"). Those middlewares are:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"req.cookies")," - An object containing the cookies sent by the request. Defaults to ",Object(i.b)("inlineCode",{parentName:"li"},"{}")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"req.query")," - An object containing the ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://en.wikipedia.org/wiki/Query_string"}),"query string"),". Defaults to ",Object(i.b)("inlineCode",{parentName:"li"},"{}")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"req.body")," - An object containing the body parsed by ",Object(i.b)("inlineCode",{parentName:"li"},"content-type"),", or ",Object(i.b)("inlineCode",{parentName:"li"},"null")," if no body was sent")),Object(i.b)("h2",{id:"custom-config"},"Custom config"),Object(i.b)("p",null,"Every API route can export a ",Object(i.b)("inlineCode",{parentName:"p"},"config")," object to change the default configs, which are the following:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"export const config = {\n  apiConfig: {\n    bodyParser: {\n      sizeLimit: '1mb',\n    },\n  },\n}\n")),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"api")," object includes all configs available for API routes."),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"bodyParser")," Enables body parsing, you can disable it if you want to consume it as a ",Object(i.b)("inlineCode",{parentName:"p"},"Stream"),":"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"export const config = {\n  apiConfig: {\n    bodyParser: false,\n  },\n}\n")),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"bodyParser.sizeLimit")," is the maximum size allowed for the parsed body, in any format supported by ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/visionmedia/bytes.js"}),"bytes"),", like so:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"export const config = {\n  apiConfig: {\n    bodyParser: {\n      sizeLimit: '500kb',\n    },\n  },\n}\n")),Object(i.b)("h1",{id:"enhanced-response"},"enhanced response"),Object(i.b)("p",null,"The response (",Object(i.b)("inlineCode",{parentName:"p"},"res"),") includes a set of Express.js-like methods to improve the developer experience and increase the speed of creating new API endpoints, take a look at the following example:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"export default function handler(req, res) {\n  res.status(200).json({ name: 'shuvi' })\n}\n")),Object(i.b)("p",null,"The included helpers are:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"res.status(code)")," - A function to set the status code. ",Object(i.b)("inlineCode",{parentName:"li"},"code")," must be a valid ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://en.wikipedia.org/wiki/List_of_HTTP_status_codes"}),"HTTP status code")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"res.json(body)")," - Sends a JSON response. ",Object(i.b)("inlineCode",{parentName:"li"},"body")," must be a ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://developer.mozilla.org/en-US/docs/Glossary/Serialization"}),"serialiazable object")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"res.send(body)")," - Sends the HTTP response. ",Object(i.b)("inlineCode",{parentName:"li"},"body")," can be a ",Object(i.b)("inlineCode",{parentName:"li"},"string"),", an ",Object(i.b)("inlineCode",{parentName:"li"},"object")," or a ",Object(i.b)("inlineCode",{parentName:"li"},"Buffer")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"res.redirect([status,] path)")," - Redirects to a specified path or URL. ",Object(i.b)("inlineCode",{parentName:"li"},"status")," must be a valid ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"https://en.wikipedia.org/wiki/List_of_HTTP_status_codes"}),"HTTP status code"),". If not specified, ",Object(i.b)("inlineCode",{parentName:"li"},"status"),' defaults to "307" "Temporary redirect".')))}p.isMDXComponent=!0},143:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return p}));var a=n(0),r=n.n(a),i=r.a.createContext({}),o=function(e){var t=r.a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):Object.assign({},t,e)),n},s=function(e){var t=o(e.components);return r.a.createElement(i.Provider,{value:t},e.children)};var c="mdxType",l={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},b=Object(a.forwardRef)((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,c=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&-1===t.indexOf(a)&&(n[a]=e[a]);return n}(e,["components","mdxType","originalType","parentName"]),b=o(n),p=a,u=b[s+"."+p]||b[p]||l[p]||i;return n?r.a.createElement(u,Object.assign({},{ref:t},c,{components:n})):r.a.createElement(u,Object.assign({},{ref:t},c))}));function p(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=b;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:a,o[1]=s;for(var p=2;p<i;p++)o[p]=n[p];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"}}]);